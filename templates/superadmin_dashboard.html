{% extends "base.html" %}
{% block title %}Super Admin Dashboard{% endblock %}
{% block content %}
<div class="dash-header">
    <h2>Super Admin Dashboard</h2>
    <a href="{{ url_for('superadmin_logout') }}" class="btn btn-secondary">Log Out</a>
</div>

{% if not games %}
<div class="card center-card">
    <p>No games on the platform yet.</p>
</div>
{% else %}
<div class="table-wrapper">
    <table class="data-table">
        <thead>
            <tr>
                <th>Game</th>
                <th>Teams</th>
                <th>ID</th>
                <th>Spots</th>
                <th>Players</th>
                <th>Created</th>
                <th>Status</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for g in games %}
            <tr>
                <td><strong>{{ g.name }}</strong></td>
                <td>{{ g.team_x }} vs {{ g.team_y }}</td>
                <td><code>{{ g.id }}</code></td>
                <td>{{ g.claim_count }}/100</td>
                <td>{{ g.player_count }}</td>
                <td>{{ g.created_at[:16].replace("T", " ") }}</td>
                <td>
                    {% if g.locked %}
                        <span class="badge badge-red">Locked</span>
                    {% endif %}
                    {% if g.numbers_released %}
                        <span class="badge badge-green">Released</span>
                    {% else %}
                        <span class="badge">Active</span>
                    {% endif %}
                    {% if g.unread_count %}
                        <span class="badge badge-orange">{{ g.unread_count }} msg</span>
                    {% endif %}
                </td>
                <td>
                    <div style="display:flex;gap:0.3rem;flex-wrap:wrap;">
                        <a href="{{ url_for('admin_panel', game_id=g.id) }}" class="btn btn-small btn-primary">Manage</a>

                        <form method="post" action="{{ url_for('superadmin_lock', game_id=g.id) }}" style="display:inline;">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-small {% if g.locked %}btn-unban{% else %}btn-lock{% endif %}">
                                {% if g.locked %}Unlock{% else %}Lock{% endif %}
                            </button>
                        </form>

                        <form method="post" action="{{ url_for('superadmin_shutdown', game_id=g.id) }}" style="display:inline;"
                              onsubmit="return confirm('Permanently delete game \'{{ g.name }}\'? This cannot be undone.')">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-small btn-danger">Delete</button>
                        </form>
                    </div>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}

<div style="margin-top:2rem;">
    <div class="dash-header">
        <h2>User Accounts</h2>
    </div>

    <div class="card" style="margin-bottom:1rem;">
        <h3>Create User</h3>
        <form method="post" action="{{ url_for('superadmin_create_user') }}" style="display:flex;gap:0.5rem;align-items:end;flex-wrap:wrap;">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
            <div>
                <label for="new_username">Username</label>
                <input type="text" name="username" id="new_username" placeholder="Username" required class="input" style="width:auto;" maxlength="30">
            </div>
            <div>
                <label for="new_password">Password</label>
                <input type="password" name="password" id="new_password" placeholder="Password (min 4)" required class="input" style="width:auto;" minlength="4">
            </div>
            <button type="submit" class="btn btn-primary btn-small">Create</button>
        </form>
    </div>

    {% if users %}
    <div class="table-wrapper">
        <table class="data-table">
            <thead>
                <tr>
                    <th>Username</th>
                    <th>Created</th>
                    <th>Games</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for u in users %}
                <tr>
                    <td><strong>{{ u.username }}</strong></td>
                    <td>{{ u.created_at[:16].replace("T", " ") }}</td>
                    <td>{{ u.game_count }}</td>
                    <td>
                        <form method="post" action="{{ url_for('superadmin_delete_user', user_id=u.id) }}" style="display:inline;"
                              onsubmit="return confirm('Delete user \'{{ u.username }}\'?')">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            <button type="submit" class="btn btn-small btn-danger">Delete</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p style="color:#8b949e;">No user accounts yet.</p>
    {% endif %}
</div>
{% endblock %}
